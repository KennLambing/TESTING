"use strict";function _typeof(i){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(i){return typeof i}:function(i){return i&&"function"==typeof Symbol&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i})(i)}!function(u){var _,f,w=null,p=[],v=[],c=null,g=0,T=0,b={calcStringTime:function(i){var e=i.split(":");return 60*Number(e[0])*60+60*Number(e[1])},formatTime:function(i){var e=i%3600;return""+Math.floor(i/36e3)+Math.floor(i/3600%10)+":"+(""+Math.floor(e/600)+Math.floor(e/60%10))},scheduleData:function(){return p},timelineData:function(){var i,e=[];for(i in v)e[i]=v[i],e[i].schedule=[];for(i in p){var t=p[i];void 0!==t.timeline&&void 0!==e[t.timeline]&&e[t.timeline].schedule.push(t)}return e},resetData:function(){for(var i in p=[],_.find(".sc_bar").remove(),v)v[i].schedule=[],b._resizeRow.apply(this,[i,0]);return this},addSchedule:function(i,e){var t={start:b.calcStringTime(e.start),end:b.calcStringTime(e.end),text:e.text,timeline:i};return e.data&&(t.data=e.data),b._addScheduleData.apply(this,[i,t]),b._resetBarPosition.apply(this,[i]),this},addRow:function(i,e){return b._addRow.apply(this,[i,e]),this},resetRowData:function(){return p=[],v=[],_.find(".sc_bar").remove(),_.find(".timeline").remove(),_.find(".sc_data").height(0),this},setRows:function(i){for(var e in b.resetRowData.apply(this,[]),i)b.addRow.apply(this,[e,i[e]]);return this},setDraggable:function(i){i!==w.draggable&&((w.draggable=i)?_.find(".sc_bar").draggable("enable"):_.find(".sc_bar").draggable("disable"))},setResizable:function(i){i!==w.resizable&&((w.resizable=i)?_.find(".sc_bar").resizable("enable"):_.find(".sc_bar").resizable("disable"))},_getTimeLineNumber:function(i){var e=0,t=0,n=Math.ceil(i/(w.timeLineY+w.timeLinePaddingTop+w.timeLinePaddingBottom));for(var a in w.rows){var s=w.rows[a],d=0;if("object"===_typeof(s.schedule)&&(d=s.schedule.length),c&&c.timeline&&d++,n<=(t+=Math.max(d,1)))break;e++}return e},_addScheduleBgData:function(i){var e=Math.ceil((i.start-g)/w.widthTime),t=Math.floor((i.end-g)/w.widthTime),n=u('<div class="sc_bgBar"><span class="text"></span></div>');n.css({left:e*w.widthTimeX,top:0,width:(t-e)*w.widthTimeX,height:_.find(".sc_main .timeline").eq(i.timeline).height()}),i.text&&n.find(".text").text(i.text),i.class&&n.addClass(i.class),_.find(".sc_main .timeline").eq(i.timeline).append(n)},_addScheduleData:function(i,e){var t=Math.ceil((e.start-g)/w.widthTime),n=Math.floor((e.end-g)/w.widthTime),a=u('<div class="sc_bar"><span class="head"><span class="time"></span></span><span class="text"></span></div>'),s=b.formatTime(e.start),d=b.formatTime(e.end),o=b._getScheduleCount.apply(f,[e.timeline]);a.css({left:t*w.widthTimeX,top:o*w.timeLineY+w.timeLinePaddingTop,width:(n-t)*w.widthTimeX,height:w.timeLineY}),a.find(".time").text(s+"-"+d),e.text&&a.find(".text").text(e.text),e.class&&a.addClass(e.class),_.find(".sc_main .timeline").eq(i).append(a),p.push(e),w.onAppendSchedule&&w.onAppendSchedule(a,e);var r=p.length-1;a.data("sc_key",r),a.bind("mouseup",function(){if(w.onClick&&!0!==u(this).data("dragCheck")&&!0!==u(this).data("resizeCheck")){var i=u(this),e=i.data("sc_key");w.onClick(i,p[e])}});var l=_.find(".sc_bar");return l.draggable({grid:[w.widthTimeX,1],containment:".sc_main",helper:"original",start:function(i,e){var t={};t.node=this,t.offsetTop=e.position.top,t.offsetLeft=e.position.left,t.currentTop=e.position.top,t.currentLeft=e.position.left,t.timeline=b._getTimeLineNumber.apply(f,[e.position.top]),t.nowTimeline=t.timeline,c=t},drag:function(i,e){if(u(this).data("dragCheck",!0),!c)return!1;var t=u(this),n=t.data("sc_key"),a=b._getTimeLineNumber.apply(f,[e.position.top]);return e.position.left=Math.floor(e.position.left/w.widthTimeX)*w.widthTimeX,c.nowTimeline!==a&&(c.nowTimeline=a),c.currentTop=e.position.top,c.currentLeft=e.position.left,b._rewriteBarText.apply(f,[t,p[n]]),!0},stop:function(){u(this).data("dragCheck",!1),c=null;var i=u(this),e=i.data("sc_key"),t=i.position().left,n=g+Math.floor(t/w.widthTimeX)*w.widthTime,a=n+(p[e].end-p[e].start);p[e].start=n,p[e].end=a,w.onChange&&w.onChange(i,p[e])}}),l.resizable({handles:"e",grid:[w.widthTimeX,w.timeLineY],minWidth:w.widthTimeX,start:function(){u(this).data("resizeCheck",!0)},resize:function(i,e){e.element.height(e.size.height),e.element.width(e.size.width)},stop:function(){var i=u(this),e=i.data("sc_key"),t=i.position().left,n=i.outerWidth(),a=g+Math.floor(t/w.widthTimeX)*w.widthTime,s=g+Math.floor((t+n)/w.widthTimeX)*w.widthTime,d=p[e].timeline;p[e].start=a,p[e].end=s,b._resetBarPosition.apply(f,[d]),b._rewriteBarText.apply(f,[i,p[e]]),i.data("resizeCheck",!1),w.onChange&&w.onChange(i,p[e])}}),!1===w.draggable&&l.draggable("disable"),!1===w.resizable&&l.resizable("disable"),r},_getScheduleCount:function(i){var e=0;for(var t in p)p[t].timeline===i&&e++;return e},_addRow:function(i,e){var t,n=_.find(".sc_main .timeline").length;t="";var a=u(t+='<div class="timeline"></div>');e.title&&a.append('<span class="timeline-title">'+e.title+"</span>"),e.subtitle&&a.append('<span class="timeline-subtitle">'+e.subtitle+"</span>"),w.onInitRow&&w.onInitRow(a,e),_.find(".sc_data_scroll").append(a),t="";for(var s=u(t+='<div class="timeline"></div>'),d=g;d<T;d+=w.widthTime){var o=u('<div class="tl"></div>');o.outerWidth(w.widthTimeX),o.data("time",b.formatTime(d)),o.data("timeline",i),s.append(o)}if(s.find(".tl").click(function(){w.onScheduleClick&&w.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),v[u(this).data("timeline")])}),s.find(".tl").on("contextmenu",function(){return w.onScheduleClick&&w.onScheduleClick(this,u(this).data("time"),u(this).data("timeline"),v[u(this).data("timeline")]),!1}),_.find(".sc_main").append(s),(v[i]=e).class&&""!==e.class&&(_.find(".sc_data .timeline").eq(n).addClass(e.class),_.find(".sc_main .timeline").eq(n).addClass(e.class)),e.schedule)for(var r in e.schedule){var l=e.schedule[r],c=b.calcStringTime(l.start),h=b.calcStringTime(l.end),m={};m.start=c,m.end=h,l.text&&(m.text=l.text),m.timeline=r,m.data={},l.data&&(m.data=l.data),b._addScheduleData.apply(f,[n,m])}b._resetBarPosition.apply(f,[n]),_.find(".sc_main .timeline").eq(n).droppable({accept:".sc_bar",drop:function(i,e){var t=e.draggable,n=t.data("sc_key"),a=p[n].timeline,s=_.find(".sc_main .timeline").index(this);p[n].timeline=s,t.appendTo(this),b._resetBarPosition.apply(f,[a]),b._resetBarPosition.apply(f,[s])}}),w.onAppendRow&&_.find(".sc_main .timeline").eq(n).find(".sc_bar").each(function(){var i=u(this),e=i.data("sc_key");w.onAppendRow(i,p[e])})},_rewriteBarText:function(i,e){var t=i.position().left,n=g+Math.floor(t/w.widthTimeX)*w.widthTime,a=n+(e.end-e.start),s=b.formatTime(n)+"-"+b.formatTime(a);u(i).find(".time").html(s)},_resetBarPosition:function(i){var e,t,n,a,s,d,o,r,l=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),c=[],h=[],m=0;for(r=0;r<l.length;r++)c[r]={code:r,x:u(l[r]).position().left};for(c.sort(function(i,e){return i.x<e.x?-1:i.x>e.x?1:0}),r=0;r<c.length;r++){for(n=c[r].code,e=u(l[n]),m=0;m<h.length;m++){for(var f=!1,p=0;p<h[m].length;p++)a=h[m][p],t=u(l[a]),s=e.position().left,o=e.position().left+e.outerWidth(),d=t.position().left,s<t.position().left+t.outerWidth()&&d<o&&(f=!0);if(!f)break}h[m]||(h[m]=[]),e.css({top:m*w.timeLineY+w.timeLinePaddingTop}),h[m][h[m].length]=n}b._resizeRow.apply(this,[i,h.length])},_resizeRow:function(i,e){var t=Math.max(e,1);_.find(".sc_data .timeline").eq(i).outerHeight(t*w.timeLineY-w.timeLineBorder+w.timeLinePaddingTop+w.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).outerHeight(t*w.timeLineY-w.timeLineBorder+w.timeLinePaddingTop+w.timeLinePaddingBottom),_.find(".sc_main .timeline").eq(i).find(".sc_bgBar").each(function(){u(this).outerHeight(u(this).closest(".timeline").outerHeight())}),_.find(".sc_data").outerHeight(_.find(".sc_main_box").outerHeight())},_resizeWindow:function(){var i=_.width()-w.dataWidth-w.verticalScrollbar,e=Math.floor((T-g)/w.widthTime);_.find(".sc_header_cell").width(w.dataWidth),_.find(".sc_data,.sc_data_scroll").width(w.dataWidth),_.find(".sc_header").width(i),_.find(".sc_main_box").width(i),_.find(".sc_header_scroll").width(w.widthTimeX*e),_.find(".sc_main_scroll").width(w.widthTimeX*e)},_moveSchedules:function(i,e,t){for(var n=_.find(".sc_main .timeline").eq(i).find(".sc_bar"),a=0;a<n.length;a++){var s=u(n[a]);if(e.position().left<=s.position().left){var d=s.position().left+w.widthTimeX*t,o=Math.floor((T-g)/w.widthTime)*w.widthTimeX-s.outerWidth();s.css({left:Math.max(0,Math.min(d,o))});var r=s.data("sc_key"),l=g+Math.floor(s.position().left/w.widthTimeX)*w.widthTime,c=l+(p[r].end-p[r].start);p[r].start=l,p[r].end=c,b._rewriteBarText.apply(f,[s,p[r]]),w.onChange&&w.onChange(s,p[r])}}b._resetBarPosition.apply(f,[i])},init:function(i){_=u(this),f=this,w=u.extend({className:"jq-schedule",rows:{},startTime:"07:00",endTime:"19:30",widthTimeX:25,widthTime:600,timeLineY:50,timeLineBorder:1,timeBorder:1,timeLinePaddingTop:0,timeLinePaddingBottom:0,headTimeBorder:1,dataWidth:160,verticalScrollbar:0,bundleMoveWidth:1,draggable:!0,resizable:!0,onInitRow:null,onChange:null,onClick:null,onAppendRow:null,onAppendSchedule:null,onScheduleClick:null},i),g=b.calcStringTime(w.startTime),T=b.calcStringTime(w.endTime),g-=g%w.widthTime,T-=T%w.widthTime;var e='<div class="sc_menu">\n<div class="sc_header_cell"><span>&nbsp;</span></div>\n<div class="sc_header">\n<div class="sc_header_scroll"></div>\n</div>\n</div>\n<div class="sc_wrapper">\n<div class="sc_data">\n<div class="sc_data_scroll"></div>\n</div>\n<div class="sc_main_box">\n<div class="sc_main_scroll">\n<div class="sc_main"></div>\n</div>\n</div>\n</div>';_.append(e),_.addClass(w.className),_.find(".sc_main_box").scroll(function(){_.find(".sc_data_scroll").css("top",-1*u(this).scrollTop()),_.find(".sc_header_scroll").css("left",-1*u(this).scrollLeft())});for(var t=-1,n=g;n<T;n+=w.widthTime)if(t<0||Math.floor(t/3600)!==Math.floor(n/3600)){e="",e+='<div class="sc_time">'+b.formatTime(n)+"</div>";var a=u(e),s=Number(Math.min(3600*Math.ceil((n+w.widthTime)/3600),T)-n),d=Math.floor(s/w.widthTime);a.width(d*w.widthTimeX),_.find(".sc_header_scroll").append(a),t=n}for(var o in u(window).resize(function(){b._resizeWindow.apply(f)}).trigger("resize"),w.rows)b._addRow.apply(this,[o,w.rows[o]]);return this}};u.fn.timeSchedule=function(i){return b[i]?b[i].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==_typeof(i)&&i?(u.error("Method "+i+" does not exist on jQuery.timeSchedule"),this):b.init.apply(this,arguments)}}(jQuery);
//# sourceMappingURL=jq.schedule.min.js.map
